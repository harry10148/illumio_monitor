# Illumio PCE Monitor - Development Guide

這份文件旨在幫助開發者快速上手本專案，並說明如何使用 **Antigravity** (或其他 AI 輔助工具) 進行持續開發與維護。

## 1. 環境建置 (Environment Setup)

本專案使用 Python 3 開發，建議使用虛擬環境 (Virtual Environment) 隔離相依套件。

### 1.1 系統需求
- Python 3.6+
- pip (Python Package Installer)

### 1.2 安裝步驟

1.  **Clone 專案** (假設你已取得程式碼):
    ```bash
    git clone <repository_url>
    cd illumio_monitor
    ```

2.  **建立虛擬環境 (建議)**:
    ```bash
    # Windows
    python -m venv venv
    .\venv\Scripts\activate

    # macOS/Linux
    python3 -m venv venv
    source venv/bin/activate
    ```

3.  **安裝相依套件**:
    ```bash
    pip install -r requirements.txt
    ```
    *目前僅依賴 `requests` 套件。*

## 2. 專案結構 (Project Structure)

本專案已重構為模組化架構，所有程式碼位於 `illumio_monitor` 目錄下。

```
illumio_monitor/              # 專案根目錄 (Project Root)
├── illumio_monitor/          # Python Package (核心邏輯)
│   ├── __init__.py           # 版本資訊 (v70.0.0)
│   ├── main.py               # 主選單與程式入口邏輯
│   ├── api_client.py         # 處理所有與 PCE API 的連線與查詢
│   ├── analyzer.py           # 分析流量、事件數據的核心演算法
│   ├── reporter.py           # 負責產生告警與發送 Email
│   ├── config.py             # 設定檔管理 (載入/儲存 JSON)
│   ├── settings.py           # 系統設定選單與 Incident Catalog
│   └── utils.py              # 共用工具 (Logging, Colors, Safe Input)
├── logs/                     # 存放 Log 檔案 (Git Ignore)
├── DOC/                      # 相關文件 (PDF 等)
├── tests/                    # 單元測試 (Unit Tests)
├── monitor_wrapper.py        # 程式執行入口 (Wrapper Script)
├── illumio_pce_config.json   # 設定檔 (API Key, Rules, SMTP)
├── illumio_pce_state.json    # 狀態檔 (Last Check Time, History)
├── requirements.txt          # Python 相依套件列表
└── README.md                 # 使用者手冊
```

## 3. 開發流程 (Development Workflow)

### 3.1 執行程式
開發過程中，請透過根目錄的 `monitor_wrapper.py` 啟動程式：

```bash
python monitor_wrapper.py
```

### 3.2 關鍵模組說明
- **新增功能**: 通常涉及修改 `main.py` (選單) 以及對應的 `analyzer.py` 或 `reporter.py`。
- **修改 API**: 若需新增 API 呼叫，請在 `api_client.py` 中新增方法。
- **新增設定**: 修改 `config.py` 定義預設值，並在 `settings.py` 新增對應的 UI 選項。

### 3.3 Antigravity 協作指南 (For AI Development)

若您使用 Antigravity (Google Deepmind Agent) 繼續開發，請遵循以下模式：

1.  **讀取狀態**:
    啟動 Agent 後，請先讀取 `task.md` 與 `implementation_plan.md` (如果存在)，了解目前的開發進度與待辦事項。

2.  **遵循架構**:
    嚴格遵守目前的模組化架構。不要將邏輯寫回 `monitor_wrapper.py` 或單一大檔。

3.  **使用絕對路徑**:
    本專案已設定 `illumio_monitor` 為 Root。在讀取/寫入 Config 與 State 檔案時，請確保使用 `config.py` 與 `analyzer.py` 中定義的動態絕對路徑邏輯：
    ```python
    PKG_DIR = os.path.dirname(os.path.abspath(__file__))
    ROOT_DIR = os.path.dirname(PKG_DIR)
    CONFIG_FILE = os.path.join(ROOT_DIR, "illumio_pce_config.json")
    ```

4.  **文件更新**:
    完成功能後，請同步更新 `README.md` (如果是使用者可見的功能) 與 `walkthrough.md` (如果是架構變更)。

## 4. 測試 (Testing)

目前專案包含基本的單元測試。

```bash
# 執行所有測試
python -m unittest discover tests
```

---
Generated by Antigravity - 2026-02-16
